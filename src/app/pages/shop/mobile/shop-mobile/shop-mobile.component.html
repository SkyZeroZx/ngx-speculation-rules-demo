<section class="min-h-screen bg-gray-50">
  <header class="sticky top-0 z-50 bg-white shadow-sm border-b border-gray-200">
    <div class="px-4 py-3">
      <div class="flex items-center justify-between mb-3">
        <h1 class="text-xl font-bold text-gray-900">Shop Mobile</h1>
        <div class="flex items-center gap-2">
          <button
            tuiButton
            appearance="outline"
            size="xs"
            (click)="onViewModeToggle()"
            class="!p-1.5"
            type="button"
          >
            <tui-icon
              [icon]="viewMode() === 'grid' ? '@tui.grid' : '@tui.list'"
              class="w-4 h-4"
            />
          </button>
        </div>
      </div>
    </div>

    <section class="overflow-x-auto scrollbar-hide pb-2 no-scrollbar">
      <div class="flex gap-3 px-4 min-w-max">
        @for (category of categories.value(); track $index) {
        <a
          routerLinkActive
          #link="routerLinkActive"
          class="flex-shrink-0 cursor-pointer"
          [appearance]="link.isActive ? 'accent' : 'outline'"
          [routerLink]="`/${category}`"
          tuiChip
        >
          {{ category | titlecase }}
        </a>

        }
      </div>
    </section>
  </header>

  <section class="px-4 py-4">
    @if (!listProducts.isLoading()) {
    <div class="mb-4">
      <p class="text-sm text-gray-600">
        {{ products().length }} products found
      </p>
    </div>
    } @if (listProducts.isLoading() ) {
    <div class="space-y-4">
      @for (item of [].constructor(6); track $index) {
      <div class="animate-pulse">
        <ngx-skeleton-loader
          count="1"
          [theme]="{
            height: viewMode() === 'grid' ? '280px' : '120px',
            'border-radius': '12px',
            'background-color': '#f3f4f6',
            'animation-duration': '1.5s'
          }"
        />
      </div>
      }
    </div>
    } @if (!listProducts.isLoading() ) {
    <div
      [class]="'grid gap-4 ' + gridCols()"
      scrollEnd
      (scrollEndEvent)="loadMore()"
    >
      @for (product of products(); track product.id) {
      <app-product-web
        [product]="product"
        [layout]="viewMode()"
        [showQuickActions]="true"
        [showDescription]="viewMode() === 'list'"
        (addToCart)="onProductAddToCart($event)"
        (addToWishlist)="onProductAddToWishlist($event)"
        (viewProduct)="onProductView($event)"
        class="block h-full"
      />
      }
    </div>
    }

    <!-- Load More Loading State -->
    @if (listProducts.isLoading() ) {
    <div class="mt-6 flex justify-center">
      <tui-loader size="m" />
    </div>
    } @if (endOfList() ) {
    <div class="mt-8 text-center py-6">
      <div
        class="inline-flex items-center justify-center w-12 h-12 bg-gray-100 rounded-full mb-3"
      >
        <tui-icon icon="@tui.check" class="w-6 h-6 text-gray-600" />
      </div>
      <p class="text-gray-600 font-medium">You've seen all products</p>
      <p class="text-sm text-gray-500 mt-1">Check back later for new items</p>
    </div>
    } @if (!listProducts.isLoading() ) {
    <div class="text-center py-12">
      <div
        class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4"
      >
        <tui-icon icon="@tui.search" class="w-8 h-8 text-gray-400" />
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No products found</h3>
      <p class="text-gray-500 mb-4">
        Try adjusting your search or filter criteria
      </p>
      <button
        routerLink="/"
        tuiButton
        appearance="primary"
        size="m"
        type="button"
      >
        Clear filters
      </button>
    </div>
    } @if (listProducts.error()) {
    <div class="text-center py-12">
      <div
        class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4"
      >
        <tui-icon icon="@tui.alert-circle" class="w-8 h-8 text-red-500" />
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">
        Something went wrong
      </h3>
      <p class="text-gray-500 mb-4">
        Unable to load products. Please try again.
      </p>
      <button
        tuiButton
        appearance="primary"
        size="m"
        (click)="resetFilter()"
        type="button"
      >
        Retry
      </button>
    </div>
    }
  </section>
</section>
